<?php	 require_once '../config.php';	if($_REQUEST['id']){		$ecid=(int)$_REQUEST['id'];		@$ecs=mysql::query('*','dm_eclass',"ecid='{$ecid}'",'one');	}elseif($_POST['id']){		$ecid=(int)$_POST['id'];	}else{		exit();	}	if(isset($ecid)){		@$ecs=mysql::query('*','dm_eclass',"ecid='{$ecid}'",'one');		if($ecs){			if($ecs['state']=='0'){				common::alertMsg('该空课表还未发布哦~，请小伙伴耐心等候','index.php');			}		}else{			common::alertMsg('哈哈，走到火星了吧~','index.php');		}	}?><!doctype html><html><head><meta charset="utf-8"><title><?php echo $ecs['ecname'];?></title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="icon" type="image/png" href="assets/i/favicon.png"><link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png"><meta name="apple-mobile-web-app-title" content="Amaze UI" /><link rel="stylesheet" type="text/css" href="../assets/css/amazeui.min.css"></head><!-- 总课表处理方法 --><?php if($ecs['sdb']==1):?><?php common::alert('请勾选无课所对应的时间段');?><link rel="stylesheet" type="text/css" href="../assets/css/mystyle.css"><body id="ecs"><div id="ecs_main"><div class="title"><?php echo $ecs['ecname'];?></div><div class="time"><?php echo $ecs['dt'];?></div><form action="action.php?act=3&id=<?php echo $ecid;?>" enctype="multipart/form-data" method="POST" name="classEmptyform" id="classEmptyform" class="classEmptyform"><div>姓名:<input style="margin:10px 0px 20px 5px;" type="text" name="name" id="name" class="ecs_input"></div>	<table class="classEmptySheet">	<tr>		<?php for($i=0;$i<=7;$i++):?>			<?php if($i==0):?>				<td class="classEmptySheetTitle"></td>			<?php else:?>				<td align="center">星期<?php echo $i;?></td>			<?php endif;?>		<?php endfor;?>	<?php for($i=0;$i<77;$i++):?>		<?php if($i%7==0):$rows=$i/7+1;?>			</tr><tr><td align="center">第<?php echo $rows;?>节</td>		<?php endif;?>		<td>			<input class="classEmptyBottom" type="checkbox" name="val[]" value="<?php echo $i;?>">		</td>	<?php endfor;?>	</tr></table><div class="operation"><input type="button" onclick="CheckName()" value="提交"><input type="reset" value="重置"></div></form><!-- 单双周课表处理方法 --><?php elseif($ecs['sdb']==0):?><?php common::alert('请勾选无课所对应的时间段\n因单双周大部分课程一致，现已增加快捷复制功能');?><link rel="stylesheet" type="text/css" href="../assets/css/mystyle.css"><body id="ecs"><div id="ecs_main"><div class="title"><?php echo $ecs['ecname'];?></div><div class="time"><?php echo $ecs['dt'];?></div><form action="action.php?act=3&id=<?php echo $ecid;?>" enctype="multipart/form-data" method="POST" name="classEmptyform" id="classEmptyform" class="classEmptyform"><div>姓名:<input style="margin:10px 0px 20px 5px;" type="text" name="name" id="name" class="ecs_input"></div><table class="classEmptySheet"><tr>	<?php for($i=0;$i<=7;$i++):?>		<?php if($i==0):?>			<td class="classEmptySheetTitle" style="color:red;">单周</td>		<?php else:?>			<td align="center">星期<?php echo $i;?></td>		<?php endif;?>	<?php endfor;?><?php for($i=0;$i<77;$i++):?>	<?php if($i%7==0):?>	<?php $rows=$i/7+1;?>		</tr><tr><td align="center">第<?php echo $rows;?>节</td>	<?php endif;?>	<td>		<input class="classEmptyBottom single" type="checkbox" name="vals[]" value="<?php echo $i;?>">	</td><?php endfor;?></tr></table><table class="classEmptySheet"><tr>	<?php for($i=0;$i<=7;$i++):?>		<?php if($i==0):?>			<td class="classEmptySheetTitle" style="color:red;">双周</td>		<?php else:?>			<td align="center">星期<?php echo $i;?></td>		<?php endif;?>	<?php endfor;?><?php for($i=0;$i<77;$i++):?>	<?php if($i%7==0):?>	<?php $rows=$i/7+1;?>		</tr><tr><td align="center">第<?php echo $rows;?>节</td>	<?php endif;?>	<td>		<input class="classEmptyBottom double" type="checkbox" name="vald[]" value="<?php echo $i;?>">	</td><?php endfor;?></tr></table><div class="operation">	<input type="button" value="复制单周到双周" onclick="SingleToDouble()">	<input type="button" value="复制双周到单周" onclick="DoubleToSingle()">	<input type="button" onclick="CheckName()" value="提交">	<input type="reset" style="background:#FE2E2E;color:#FFF" value="重置"></div></form></div>	<!-- 从教务网导入的处理办法  -->	<?php elseif($ecs['sdb']==2):?>	<?php 		session_start();		$id=session_id();		$_SESSION['id']=$id;		$cookie = dirname(__FILE__) . '/cookie/'.$_SESSION['id'].'.txt'; //cookie路径  		$verify_code_url = "http://jwweb.scujcc.cn/CheckCode.aspx"; //验证码地址		$curl = curl_init();		curl_setopt($curl, CURLOPT_URL, $verify_code_url);		curl_setopt($curl, CURLOPT_COOKIEJAR, $cookie);  //保存cookie		curl_setopt($curl, CURLOPT_HEADER, 0);		curl_setopt($curl, CURLOPT_RETURNTRANSFER, 1);		$img = curl_exec($curl);  //执行curl		curl_close($curl);		$fp = fopen("./cookie/{$_SESSION['id']}.jpg","w");  //文件名		fwrite($fp,$img);  //写入文件 		fclose($fp);	?>	<body>		<script>			alert('因为服务器问题，导致页面以及授权访问时加载缓慢，请耐心等待服务器加载数据。');		</script>		<div class="header" style="text-align: center;">			<div class="am-g">				<h1 style="font-size: 200%;color: #333;margin-top: 20px;"><?php echo $ecs['ecname'];?></h1>				<p style="font-size: 14px;"><?php echo $ecs['dt'];?>				<br>我们将通过您的教务授权来访问您的课表信息，我们不会记录您的账号与密码			</div>		  <hr />		</div>		<div class="am-g" style="margin-top:50px;">		  <div class="am-u-lg-3 am-u-md-5 am-u-sm-centered">			<form class="am-form" action="saveClass.php?id=<?php echo $ecid;?>" enctype="application/x-www-form-urlencoded" method="POST">			<fieldset class="am-form-set">					<div class="am-input-group">					  <span class="am-input-group-btn">						<button class="am-btn am-btn-default" type="button"><span class="am-icon-user am-icon-fw"></span> </button>					  </span>					  <input type="text" name="xh" class="am-form-field" placeholder="请输入您的学号">					</div>			</fieldset>			<fieldset class="am-form-set">					<div class="am-input-group">					  <span class="am-input-group-btn">						<button class="am-btn am-btn-default" type="button"><span class="am-icon-lock am-icon-fw"></span> </button>					  </span>					  <input type="password" name="pw" class="am-form-field" placeholder="请输入您的教务网密码">					</div>			</fieldset>			<fieldset class="am-form-set">					<div class="am-input-group">					  <input type="text" name="code" class="am-form-field" placeholder="请输入右侧验证码">					  <span class="am-input-group-btn">						<a><img src="./cookie/<?php echo $_SESSION['id'].'.jpg'?>" alt=""></a>					  </span>					</div>			</fieldset>			  <button type="submit" class="am-btn am-btn-primary am-btn-block">登陆并授权访问课表</button>			</form>		  </div>		</div>	</body>	<?php endif;?><div class="am-g">  <div class="am-u-lg-10 am-u-md-10 am-u-sm-centered">	<div style="display:table;margin:0 auto;padding-top:5px;color:#000;">POWER BY <a href="http://www.maindb.cn">MAIN TEAM</a></div>  </div></div><script type="text/javascript">var singleNodes=document.getElementsByClassName("single");var doubleNodes=document.getElementsByClassName("double");function SingleToDouble(){	var max=Number(<?php echo $i?>);	for(i=0;i<max;i++){		doubleNodes[i].checked=singleNodes[i].checked;	}	}function DoubleToSingle(){	var max=Number(<?php echo $i?>);	for(i=0;i<max;i++){		singleNodes[i].checked=doubleNodes[i].checked;	}}function CheckName(){	var name=document.getElementById("name");	if(name.value==''){		alert('姓名不能为空');	}else{		var form=document.getElementById('classEmptyform');		form.submit();	}}</script></html>